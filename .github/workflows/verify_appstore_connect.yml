name: Verify App Store Connect Signing

on:
  workflow_dispatch:

jobs:
  verify-asc-signing:
    runs-on: macos-14

    env:
      APPLE_ID:                        ${{ secrets.APPLE_ID }}
      APP_IDENTIFIER:                  ${{ secrets.APP_IDENTIFIER }}
      APPLE_TEAM_ID:                   ${{ secrets.APPLE_TEAM_ID }}
      APP_STORE_CONNECT_API_KEY_ID:    ${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}
      APP_STORE_CONNECT_API_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_API_ISSUER_ID }}
      APP_STORE_CONNECT_API_KEY_BASE64: ${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }}
      IOS_DIST_CERT_BASE64:            ${{ secrets.IOS_DIST_CERT_BASE64 }}
      IOS_DIST_CERT_PASSWORD:          ${{ secrets.IOS_DIST_CERT_PASSWORD }}

    steps:
      - name: üßæ Checkout code
        uses: actions/checkout@v4

      - name: üíé Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
          bundler-cache: true

      - name: üì¶ Install bundle
        run: bundle install --path vendor/bundle

      - name: üîç Verify App Store Connect signing
        run: bundle exec fastlane ios verify_appstore_connect
