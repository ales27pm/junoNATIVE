# .github/workflows/verify_appstore_connect.yml
name: Verify App Store Connect signing chain

on:
  # Run on demand from the Actions tab
  workflow_dispatch:

jobs:
  verify:
    runs-on: macos-14

    steps:
      # 1 ‚ñ™Ô∏é Checkout the repo
      - name: Checkout
        uses: actions/checkout@v4

      # 2 ‚ñ™Ô∏é Set up Ruby (Fastlane needs it)
      - name: Set up Ruby 3.3 with bundler cache
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
          bundler-cache: true   # ‚á¶ speeds up subsequent runs

      # 3 ‚ñ™Ô∏é Install any extra Ruby gems (Fastlane is already in the Gemfile)
      - name: Bundle install
        run: bundle install --path vendor/bundle

      # 4 ‚ñ™Ô∏é Run your Fastlane verification lane
      - name: üîç Run verify_appstore_connect
        env:
          APPLE_ID:                         ${{ secrets.APPLE_ID }}
          APP_IDENTIFIER:                   ${{ secrets.APP_IDENTIFIER }}
          APPLE_TEAM_ID:                    ${{ secrets.APPLE_TEAM_ID }}
          APP_STORE_CONNECT_API_KEY_ID:     ${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}
          APP_STORE_CONNECT_API_ISSUER_ID:  ${{ secrets.APP_STORE_CONNECT_API_ISSUER_ID }}
          APP_STORE_CONNECT_API_KEY_BASE64: ${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }}
          IOS_DIST_CERT_BASE64:             ${{ secrets.IOS_DIST_CERT_BASE64 }}
          IOS_DIST_CERT_PASSWORD:           ${{ secrets.IOS_DIST_CERT_PASSWORD }}
        run: bundle exec fastlane ios verify_appstore_connect
